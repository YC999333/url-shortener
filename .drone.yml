kind: pipeline
type: docker
name: frontend_dev

steps:
  - name: lint&test
    image: node
    commands:
      - npm install
      - npm run lint
  
  - name: build image
    image: appleboy/drone-ssh
    settings:
      host:
        from_secret: ssh_host
      username: 
        from_secret: ssh_name
      key:
        from_secret: ssh_key
      port: 22
      timeout: 60s
      command_timeout: 2m
      script:
        - cd datadrive/apps/url-shortener
        - git checkout master
        - git pull origin master
        - sudo docker build -f docker/dockerfile . -t front_end:latest
        - cd ~/datadrive/nginx
        - sudo docker-compose -f docker-compose.yml up -d 

trigger:
  branch:
    - master
  event:
    - push